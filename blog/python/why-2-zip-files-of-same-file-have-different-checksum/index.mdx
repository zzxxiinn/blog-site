---
title: "åŒä¸€æ–‡ä»¶çš„ä¸¤æ¬¡zipå†…å®¹ä¸ä¸€è‡´"
date: "2022-10-12"
tags: ["python"]
embeddedImagesLocal:
  - ./image_011.jpg
---

import { getImage, GatsbyImage } from 'gatsby-plugin-image';

å¯¹åŒä¸€ä¸ªæ–‡ä»¶å¤¹è¿›è¡Œä¸¤æ¬¡zipå‹ç¼©æ“ä½œåï¼Œä¸¤ä¸ªæ–‡ä»¶æ£€æŸ¥ sha256 å´ä¸ä¸€æ ·ï¼ˆäºŒè¿›åˆ¶å†…å®¹ä¸ä¸€æ ·ï¼‰ï¼

å·¥ä½œé¡¹ç›®é‡Œï¼Œåšäº†ä¸ªæ¨¡å—æ‰“åŒ…ä¸Šä¼ åˆ°æœåŠ¡å™¨çš„å·¥å…·ã€‚å·¥å…·ä¼šæ£€æŸ¥æœ¬åœ°æ¨¡å—æœ‰æ²¡æœ‰æ”¹åŠ¨ï¼Œç„¶ååŠ å¯†ç¼–ç åä¸Šä¼ åˆ°æœåŠ¡å™¨ã€‚ä¸è¿‡æ¯æ¬¡éƒ½å°†æ‰€æœ‰çš„æ¨¡å—éƒ½æ‰“åŒ…ä¸Šä¼ ä¸€éç€å®å¾ˆæ…¢ï¼Œäºæ˜¯å°±ç®—æ¨¡å—æ–‡ä»¶çš„ sha256 å­˜ä¸‹æ¥åç»­æ‰“åŒ…è¿›è¡Œæ¯”è¾ƒã€‚

ç„¶åå°±è¸©å‘äº†ï¼šæ¯æ¬¡å°±ç®—æ¨¡å—æ²¡æœ‰æ”¹åŠ¨ï¼Œç®—å‡ºæ¥çš„ sha256 å´æ˜¯ä¸ä¸€æ ·ï¼Œç„¶åæ¯æ¬¡éƒ½å…¨éƒ¨ç»™æˆ‘æ¥ä¸€é ğŸ¤¯

Google æœäº†æœï¼Œä¹Ÿæœ‰ä¸å°‘åŒå­¦é‡åˆ°ä¸€æ ·çš„é—®é¢˜ï¼ŒåŸå› æ˜¯ zip æ‰“åŒ…æ–‡ä»¶æ—¶ï¼Œä¼šå°†æ–‡ä»¶çš„ access time(atime) ä¿ç•™åœ¨ zip çš„äºŒè¿›åˆ¶å†…å®¹ä¸­ï¼Œä»è€Œ zip æ–‡ä»¶åœ¨å†…å®¹ä¸Šä¼šæœ‰å‡ºå…¥ï¼Œå¯¼è‡´ sha256 è®¡ç®—æ¯æ¬¡éƒ½ä¸ä¸€æ ·ã€‚

ç„¶åå°±æƒ³äº†ä¸ªæ¯”è¾ƒ tricky çš„æ–¹æ³•ï¼š

```python
def zip_dir(src, output):
    """
    å‹ç¼©æŒ‡å®šæ–‡ä»¶å¤¹
    :param src: ç›®æ ‡æ–‡ä»¶å¤¹è·¯å¾„
    :param output: å‹ç¼©æ–‡ä»¶ä¿å­˜è·¯å¾„+xxxx.zip
    :return: æ— 
    """
    zip_file = zipfile.ZipFile(output, "w", zipfile.ZIP_DEFLATED)
    utime = datetime.datetime.strptime("1999-01-01", '%Y-%m-%d').timestamp()

    for p, dir_names, filenames in os.walk(src):
        fpath = p.replace(str(src), "")

        for filename in filenames:
            source_filepath = os.path.join(p, filename)
            os.utime(source_filepath, (utime, utime))
            zip_file.write(source_filepath, os.path.join(fpath, filename))

    zip_file.close()
```

åœ¨æ¯æ¬¡å‹ç¼©æ—¶ï¼Œç»Ÿä¸€æ–‡ä»¶çš„è¯»å–å’Œä¿®æ”¹æ—¶é—´ï¼

<GatsbyImage alt='meme001' image={getImage(props.localImages[0])} title='meme001'/>

è¿˜å¥½åªæ˜¯é›¶æ—¶æ–‡ä»¶ï¼Œä¸ç”¨è€ƒè™‘è¿™ä¸ªæ•°æ®ã€‚ä¸è¿‡ä¸ç®¡é»‘çŒ«ç™½çŒ«ï¼Œèƒ½æŠ“è€é¼ çš„å°±æ˜¯å¥½çŒ«~



#### å‚è€ƒ

- [åŒä¸€æ–‡ä»¶çš„ä¸¤æ¬¡ zip å†…å®¹ä¸ä¸€è‡´](https://adoyle.me/blog/why-zip-file-checksum-changed.html)
- [zip two file with same content, but final md5sum is different](https://stackoverflow.com/questions/36323139/zip-two-file-with-same-content-but-final-md5sum-is-different)