---
title: "使用 Javascript 复制内容到剪贴板"
date: "2022-07-01"
tags: ["JavaScript"]
---
import {useRef} from 'react'

export const Demo1 = () => {
    const textInput = useRef(null);
    const handleCopy = () => {
        textInput.current.select()
        document.execCommand("copy")
    }
    return <>
        <section style="display: flex;" className="example">
            <textarea ref={textInput} defaultValue="The quick brown fox jumps over the lazy dog"></textarea>
            <button onClick={handleCopy} style="margin: 8px;">copy</button>
            <textarea />
        </section>
        <p style="font-size: 12px;">点击按钮，并在右边输入框查看内容。</p>
    </>
}

## 1. `document.execCommand()`

在大多数浏览器中都是都实现了 `document.execCommand()` 方法，提供了大量对选区（其实就是页面文档选中的内容）的操作，其中可以使用 `document.execCommand('copy')` 和 `document.execCommand('paste')` 触发浏览器自己的复制和粘贴。

- 复制: document.execCommand('copy')
- 剪切: document.execCommand('cut')
- 粘贴: document.execCommand('paste')


```javascript
textInput.current.select()
document.execCommand("copy")
```

Try it:
<Demo1 />

<br />
因为是对选区内容的复制操作，所以 `document.execCommand('copy')` 复制的对象必须出现在页面中。也就是说，如果要复制的文本是 DOM 中不存在的字符串，你得先把它注入 DOM 并且选中它。并且通常情况下，得在事件回调函数中使用它，由用户自己触发会减少在某些浏览器中的报错。  

```javascript
button.addEventListener('click', (e) => {
  const input = document.createElement('input');
  document.body.appendChild(input);
  input.value = text;
  input.focus();
  input.select();
  const result = document.execCommand('copy');
  if (result === 'unsuccessful') {
    console.error('Failed to copy text.');
  }
});
```


## 2. `navigator.clipboard` 


### object methods: 
`navigator.clipboard` 提供了 4 个异步方法，执行后返回 Promise 对象。

- read()      从剪贴板读取数据（包括图片）
- readText()  从剪贴板读取文本
- write()     将任意数据导入剪贴板
- writeText() 将文本写入系统剪贴板

### read()
read 方法需要用户授权 "clipboard-read" 权限，通过后才可继续使用。

常见的使用方式：
```javascript
navigator.permissions.query({name: "clipboard-read"}).then(result => {
  // 授权成功后继续执行
  if (result.state == "granted" || result.state == "prompt") {
    navigator.clipboard.read().then(data => {
      // data 是复制中的数据，在这里处理读取到的数据
    });
  }
});

```


### readText()
读取纯文本内容，如果需要读取图片， read() 会更适合你。

```javascript
  navigator.clipboard.readText().then(
    clipText => document.getElementById("outbox").innerText = clipText
  );
```


### write()
和 read() 类似， read 方法需要用户授权 "clipboard-write" 权限，通过后才可继续使用。

write 操作同时和下面的代码结构相似：
```javascript
function setClipboard(text) {
  let data = new DataTransfer();

  data.items.add("text/plain", text);
  navigator.clipboard.write(data).then(function() {
    /* success */
  }, function() {
    /* failure */
  });
}
```

### writeText()
将纯文本写入剪贴板：

```javascript
navigator.clipboard.writeText("<empty clipboard>").then(function() {
  /* clipboard successfully set */
}, function() {
  /* clipboard write failed */
});
```





